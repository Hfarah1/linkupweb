{% extends 'base.html.twig' %}

{% block title %}Offre -
	{{ offre.titre }}
{% endblock %}

{% block content %}
	<!-- Single Page Header start -->
	<div class="container-fluid page-header py-5">
		<h1 class="text-center text-white display-6">Détails de l'offre</h1>
		<ol class="breadcrumb justify-content-center mb-0">
			<li class="breadcrumb-item">
				<a href="#">Accueil</a>
			</li>
			<li class="breadcrumb-item">
				<a href="#">Offres</a>
			</li>
			<li class="breadcrumb-item active text-white">{{ offre.titre }}</li>
		</ol>
	</div>
	<!-- Single Page Header End -->

	<!-- Single Product Start -->
	<div class="container-fluid py-5 mt-5">
		<div class="container py-5">
			<div class="row g-4 mb-5">
				<div class="col-lg-8 col-xl-9">
					<div class="row g-4">
						<div class="col-lg-6">
							<div class="border rounded" style="height: 100%; display: flex; align-items: center; justify-content: center;">
								<a href="#">
									{% if offre.organisationLogo %}
										{% set logoContent = offre.getOrganisationLogo() %}
										<img src="data:image/jpeg;base64,{{ logoContent|base64_encode }}" class="img-fluid rounded" alt="Logo {{ offre.organisation }}" style="max-width: 100%; max-height: 300px; object-fit: contain;">
									{% else %}
										<img src="{{ asset('front/img/offer-placeholder.png') }}" class="img-fluid rounded" alt="Offre {{ offre.organisation }}" style="max-width: 100%; max-height: 300px; object-fit: contain;">
									{% endif %}
								</a>
							</div>
						</div>
						<div class="col-lg-6">
							<p class="mb-2" style="font-size: 16px;">
								{{ offre.datePublication ? offre.datePublication|date('F j, Y') : 'Date non spécifiée' }}
							</p>
							<h4 class="fw-bold mb-3">{{ offre.titre }}</h4>
							<p class="mb-3">Catégorie:
								{{ offre.categorie }}</p>

							{% if offre.salaire is not null %}
								<h5 class="fw-bold mb-3">{{ offre.salaire|number_format(2, ',', ' ') }}
									DT</h5>
							{% else %}
								<h5 class="fw-bold mb-3 text-muted">Salaire non spécifié</h5>
							{% endif %}

							<div class="mb-4">
								<h5>Description:</h5>
								<p>{{ offre.description }}</p>
							</div>

							<div class="mb-4">
								<h5>Compétences requises:</h5>
								<p>{{ offre.competencesRequises|nl2br }}</p>
							</div>

							<a href="#" class="btn border border-secondary rounded-pill px-4 py-2 mb-4 text-primary">
								<i class="fa fa-shopping-bag me-2 text-primary"></i>
								Postuler à cette offre
							</a>
						</div>

						<div class="col-lg-12">
							<nav>
								<div class="nav nav-tabs mb-3">
									<button class="nav-link active border-white border-bottom-0" type="button" role="tab" id="nav-about-tab" data-bs-toggle="tab" data-bs-target="#nav-about" aria-controls="nav-about" aria-selected="true">
										Détails
									</button>
									<button class="nav-link border-white border-bottom-0" type="button" role="tab" id="nav-mission-tab" data-bs-toggle="tab" data-bs-target="#nav-mission" aria-controls="nav-mission" aria-selected="false">
										Candidatures ({{ candidatures|length }})
									</button>
								</div>
							</nav>

							<div class="tab-content mb-5">
								<div class="tab-pane active" id="nav-about" role="tabpanel" aria-labelledby="nav-about-tab">
									<div class="px-2">
										<div class="row g-4">
											<div class="col-12">
												<div class="row bg-light align-items-center text-center justify-content-center py-2">
													<div class="col-4">
														<p class="mb-0 fw-bold">Localisation</p>
													</div>
													<div class="col-8">
														<p class="mb-0">{{ offre.gouvernorat }},
															{{ offre.ville }}</p>
													</div>
												</div>
												<div class="row text-center align-items-center justify-content-center py-2">
													<div class="col-4">
														<p class="mb-0 fw-bold">Organisation</p>
													</div>
													<div class="col-8">
														<p class="mb-0">{{ offre.organisation }}</p>
													</div>
												</div>
												<div class="row bg-light text-center align-items-center justify-content-center py-2">
													<div class="col-4">
														<p class="mb-0 fw-bold">Type de contrat</p>
													</div>
													<div class="col-8">
														<p class="mb-0">{{ offre.typeContrat }}</p>
													</div>
												</div>
												<div class="row text-center align-items-center justify-content-center py-2">
													<div class="col-4">
														<p class="mb-0 fw-bold">Statut</p>
													</div>
													<div class="col-8">
														<p class="mb-0">{{ offre.statut }}</p>
													</div>
												</div>
												<div class="row bg-light text-center align-items-center justify-content-center py-2">
													<div class="col-4">
														<p class="mb-0 fw-bold">Date de publication</p>
													</div>
													<div class="col-8">
														<p class="mb-0">{{ offre.datePublication ? offre.datePublication|date('d/m/Y H:i') : 'Non spécifiée' }}</p>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>

								<div class="tab-pane" id="nav-mission" role="tabpanel" aria-labelledby="nav-mission-tab">
									{% if candidatures|length > 0 %}
										{% for candidature in candidatures %}
											<div class="d-flex mb-4 border-bottom pb-3">
												<div class="flex-shrink-0">
													<img src="{{ asset('front/img/avatar.jpg') }}" class="img-fluid rounded-circle p-3" style="width: 100px; height: 100px; object-fit: cover;" alt="Candidat">
												</div>
												<div class="flex-grow-1 ms-3">
													<p class="mb-2" style="font-size: 14px;">
														{{ candidature.dateCandidature ? candidature.dateCandidature|date('F j, Y H:i') : '' }}
													</p>
													<div class="d-flex justify-content-between align-items-center">
														<h5>Candidature #{{ candidature.idCandidature }}</h5>
														<span class="badge bg-{{ candidature.statut == 'Acceptée' ? 'success' : (candidature.statut == 'Refusée' ? 'danger' : 'warning') }}">
															{{ candidature.statut }}
														</span>
													</div>
													<div class="mt-2">
														{% if candidature.cvFile %}
															<a href="{{ asset('uploads/cv/' ~ candidature.cvFile) }}" class="btn btn-sm btn-outline-primary me-2" target="_blank">
																Voir CV
															</a>
														{% endif %}
														{% if candidature.lettreMotivation %}
															<button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#motivationLetterModal{{ candidature.idCandidature }}">
																Voir lettre de motivation
															</button>

															<!-- Modal for Motivation Letter -->
															<div class="modal fade" id="motivationLetterModal{{ candidature.idCandidature }}" tabindex="-1" aria-hidden="true">
																<div class="modal-dialog modal-lg">
																	<div class="modal-content">
																		<div class="modal-header">
																			<h5 class="modal-title">Lettre de motivation</h5>
																			<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
																		</div>
																		<div class="modal-body">
																			<p>{{ candidature.lettreMotivation|nl2br }}</p>
																		</div>
																		<div class="modal-footer">
																			<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
																		</div>
																	</div>
																</div>
															</div>
														{% endif %}
													</div>
													<div class="mt-3">
														<a href="{{ path('app_candidature_show', {'id_candidature': candidature.id_candidature}) }}" class="btn btn-sm btn-info me-2">
															Voir détails
														</a>
														<a href="{{ path('app_candidature_edit', {'id_candidature': candidature.id_candidature}) }}" class="btn btn-sm btn-warning">
															Modifier
														</a>
													</div>
												</div>
											</div>
										{% endfor %}
									{% else %}
										<div class="alert alert-info">
											Aucune candidature trouvée pour cette offre.
										</div>
									{% endif %}
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Related Offers Section -->
			<h1 class="fw-bold mb-4">Related Offers par catégories</h1>
<div class="vesitable">
    <div class="owl-carousel vegetable-carousel justify-content-center">
        {% if recommendedOffers|length > 0 %}
            {% for recommendedOffer in recommendedOffers %}
                <div class="border border-primary rounded position-relative vesitable-item d-flex flex-column h-100">
                    <a href="{{ path('app_offre_show', {'id_offre': recommendedOffer.id_offre}) }}" class="d-flex flex-column h-100 text-decoration-none">
                        <div class="vesitable-img" style="height: 300px; overflow: hidden;">
                            {% if recommendedOffer.organisationLogo %}
                                {% set logoContent = recommendedOffer.getOrganisationLogo() %}
                                <img src="data:image/jpeg;base64,{{ logoContent|base64_encode }}" 
                                     class="img-fluid w-100 h-100 rounded-top" 
                                     alt="Logo {{ recommendedOffer.organisation }}"
                                     style="object-fit: cover;">
                            {% else %}
                                <img src="{{ asset('front/img/offer-placeholder.png') }}" 
                                     class="img-fluid w-100 h-100 rounded-top" 
                                     alt="Logo {{ recommendedOffer.organisation }}"
                                     style="object-fit: cover;">
                            {% endif %}
                        </div>
                        <div class="text-white bg-primary px-3 py-1 rounded position-absolute" style="top: 10px; right: 10px;">
                            {{ recommendedOffer.categorie }}
                        </div>
                        <div class="p-3 flex-grow-1 d-flex flex-column">
                            <h4 class="mb-2">{{ recommendedOffer.titre }}</h4>
                            <p class="mb-2 flex-grow-1">{{ recommendedOffer.description|length > 100 ? recommendedOffer.description|slice(0, 100) ~ '...' : recommendedOffer.description }}</p>
                            <div class="mt-auto">
                                <p class="text-dark fs-5 fw-bold mb-0">
                                    {% if recommendedOffer.salaire %}
                                        {{ recommendedOffer.salaire|number_format(2, ',', ' ') }} DT
                                    {% else %}
                                        <span class="text-muted">Salaire non spécifié</span>
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </a>
                </div>
            {% endfor %}
        {% else %}
            <div class="alert alert-info">Aucune offre similaire trouvée.</div>
        {% endif %}
    </div>
</div>
            <!-- End Related Offers Section -->
		</div>
	</div>
</div>
<!-- Single Product End -->{% endblock %}

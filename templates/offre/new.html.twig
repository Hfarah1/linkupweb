{% extends 'base.html.twig' %}

{% block title %}Nouvelle Offre{% endblock %}

{% block content %}
    <!-- Single Page Header start -->
    <div class="container-fluid page-header py-5">
        <h1 class="text-center text-white display-6">Créer une Nouvelle Offre d'Emploi</h1>
        <ol class="breadcrumb justify-content-center mb-0">
            <li class="breadcrumb-item"><a href="{{ path('app_home') }}">Accueil</a></li>
            <li class="breadcrumb-item"><a href="{{ path('app_offre_index') }}">Offres</a></li>
            <li class="breadcrumb-item active text-white">Nouvelle Offre</li>
        </ol>
    </div>
    <!-- Single Page Header End -->

    <!-- Checkout Page Start -->
    <div class="container-fluid py-5">
        <div class="container py-5">
            <h1 class="mb-4 text-primary">Détails de l'Offre</h1>
            
            <div class="row g-5">
                <div class="col-12">
                    {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate', 'enctype': 'multipart/form-data'}}) }}
                    
                    <div class="card shadow-sm p-4 mb-4">
                        <h3 class="mb-4">Informations de Base</h3>
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="form-item w-100">
                                    {{ form_label(form.titre, 'Titre du Poste*', {'label_attr': {'class': 'form-label my-3 fw-bold'}}) }}
                                    {{ form_widget(form.titre, {'attr': {
                                        'class': 'form-control rounded',
                                        'placeholder': 'Ex: Développeur Symfony Senior',
                                        'required': 'required'
                                    }}) }}
                                    <div class="text-danger">{{ form_errors(form.titre) }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-item w-100">
                                    {{ form_label(form.type_contrat, 'Type de Contrat*', {'label_attr': {'class': 'form-label my-3 fw-bold'}}) }}
                                    {{ form_widget(form.type_contrat, {'attr': {
                                        'class': 'form-control rounded',
                                        'required': 'required'
                                    }}) }}
                                    <div class="text-danger">{{ form_errors(form.type_contrat) }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-item w-100">
                                    {{ form_label(form.gouvernorat, 'Gouvernorat*', {'label_attr': {'class': 'form-label my-3 fw-bold'}}) }}
                                    {{ form_widget(form.gouvernorat, {'attr': {
                                        'class': 'form-control rounded',
                                        'placeholder': 'Ex: Tunis',
                                        'required': 'required'
                                    }}) }}
                                    <div class="text-danger">{{ form_errors(form.gouvernorat) }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-item w-100">
                                    {{ form_label(form.ville, 'Ville*', {'label_attr': {'class': 'form-label my-3 fw-bold'}}) }}
                                    {{ form_widget(form.ville, {'attr': {
                                        'class': 'form-control rounded',
                                        'placeholder': 'Ex: Ariana',
                                        'required': 'required'
                                    }}) }}
                                    <div class="text-danger">{{ form_errors(form.ville) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm p-4 mb-4">
                        <h3 class="mb-4">Description et Organisation</h3>
                        <div class="form-item mb-4">
                            {{ form_label(form.description, 'Description*', {'label_attr': {'class': 'form-label my-3 fw-bold'}}) }}
                            {{ form_widget(form.description, {'attr': {
                                'class': 'form-control rounded',
                                'rows': 6,
                                'placeholder': 'Décrivez en détail le poste, les missions et les responsabilités',
                                'required': 'required'
                            }}) }}
                            <div class="text-danger">{{ form_errors(form.description) }}</div>
                        </div>
                        
                        <div class="row g-4">
                            <div class="col-md-4">
                                <div class="form-item w-100">
                                    {{ form_label(form.organisation, 'Organisation*', {'label_attr': {'class': 'form-label my-3 fw-bold'}}) }}
                                    {{ form_widget(form.organisation, {'attr': {
                                        'class': 'form-control rounded',
                                        'placeholder': 'Nom de votre entreprise/organisation',
                                        'required': 'required'
                                    }}) }}
                                    <div class="text-danger">{{ form_errors(form.organisation) }}</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-item w-100">
                                    {{ form_label(form.logoFile, 'Logo de l\'Organisation', {'label_attr': {'class': 'form-label my-3 fw-bold'}}) }}
                                    <div class="custom-file">
                                        {{ form_widget(form.logoFile, {'attr': {
                                            'class': 'form-control rounded',
                                            'onchange': 'previewImage(this)',
                                            'accept': 'image/*'
                                        }}) }}
                                        <div class="text-danger">{{ form_errors(form.logoFile) }}</div>
                                    </div>
                                    <div class="mt-3" id="imagePreview" style="display:none;">
                                        <img id="preview" src="#" alt="Aperçu du logo" class="img-thumbnail rounded" style="max-width: 200px; max-height: 200px;">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-item w-100">
                                    {{ form_label(form.salaire, 'Salaire (optionnel)', {'label_attr': {'class': 'form-label my-3 fw-bold'}}) }}
                                    {{ form_widget(form.salaire, {'attr': {
                                        'class': 'form-control rounded',
                                        'placeholder': 'Ex: 2500.00',
                                        'type': 'number',
                                        'step': '0.01',
                                        'min': '0'
                                    }}) }}
                                    <div class="text-danger">{{ form_errors(form.salaire) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm p-4 mb-4">
                        <h3 class="mb-4">Compétences et Catégorie</h3>
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="form-item w-100">
                                    {{ form_label(form.categorie, 'Catégorie*', {'label_attr': {'class': 'form-label my-3 fw-bold'}}) }}
                                    {{ form_widget(form.categorie, {'attr': {
                                        'class': 'form-control rounded',
                                        'required': 'required'
                                    }}) }}
                                    <div class="text-danger">{{ form_errors(form.categorie) }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-item w-100">
                                    {{ form_label(form.competences_requises, 'Compétences Requises (optionnel)', {'label_attr': {'class': 'form-label my-3 fw-bold'}}) }}
                                    {{ form_widget(form.competences_requises, {'attr': {
                                        'class': 'form-control rounded',
                                        'rows': 4,
                                        'placeholder': 'Ex: PHP, Symfony, Gestion de projet'
                                    }}) }}
                                    <div class="text-danger">{{ form_errors(form.competences_requises) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row g-4 text-center align-items-center justify-content-center pt-4">
                        <div class="col-md-6">
                            <button type="submit" class="btn btn-primary border-secondary py-3 px-4 text-uppercase w-100">
                                {{ button_label|default('CRÉER L\'OFFRE') }}
                            </button>
                        </div>
                        <div class="col-md-6">
                            <a href="{{ path('app_offre_index') }}" class="btn btn-outline-secondary border-secondary py-3 px-4 text-uppercase w-100">Retour à la Liste</a>
                        </div>
                    </div>
                    
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
    <!-- Checkout Page End -->

    <script>
        function previewImage(input) {
            const preview = document.getElementById('preview');
            const previewContainer = document.getElementById('imagePreview');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    previewContainer.style.display = 'block';
                }
                
                reader.readAsDataURL(input.files[0]);
            } else {
                preview.src = '#';
                previewContainer.style.display = 'none';
            }
        }

        // Client-side validation feedback
        document.querySelector('form.needs-validation').addEventListener('submit', function(event) {
            const form = this;
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    </script>
{% endblock %}